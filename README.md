# Руководство пользователя FitoDomik

## Описание программы

FitoDomik - это консольное приложение для управления умной теплицей. Программа позволяет:
- Анализировать состояние растений с помощью компьютерного зрения
- Отслеживать данные с датчиков (температура, влажность, освещенность и др.)
- Управлять устройствами теплицы (лампы, шторы)
- Отправлять данные на сервер для удаленного мониторинга

## Системные требования

- Windows 10 или выше
- Python 3.6 или выше
- Камера, подключенная к компьютеру
- Arduino с датчиками, подключенная к USB-порту компьютера
- Доступ в интернет для отправки данных на сервер

## Установка и настройка

1. Установите необходимые библиотеки:
```
pip install opencv-python numpy pillow requests pyserial
```

2. Подключите Arduino к компьютеру через USB
3. Подключите камеру к компьютеру
4. Получите API токен на сайте https://farm429.online/get_token.php

## Основные функции программы

### Аутентификация и настройка
- `get_api_token()` - запрашивает у пользователя API токен для доступа к серверу
- `get_interval_from_user()` - настраивает интервал отправки данных с датчиков
- `get_photo_interval_from_user()` - настраивает интервал фотографирования растений

### Анализ растений
- `run_plant_analysis()` - выполняет фотографирование и анализ состояния растения
- `PlantAnalyzer` - класс для анализа растений:
  - `detect_plant()` - обнаружение растения на фотографии
  - `detect_diseases()` - выявление возможных заболеваний
  - `detect_pests()` - выявление возможных вредителей
  - `analyze_health()` - общий анализ здоровья растения

### Мониторинг датчиков
- `run_sensor_monitoring()` - запускает постоянный мониторинг данных с датчиков
- `update_sensor_values()` - обрабатывает данные, полученные с Arduino
- `save_to_server()` - отправляет показания датчиков на сервер
- `get_max_sensor_id()` - получает максимальный ID из таблицы данных датчиков

### Управление устройствами
- `devices_control_thread()` - поток для управления лампой и шторами
- `send_command()` - отправляет команды на Arduino
- `get_led_state()` - получает состояние лампы с сервера
- `get_curtains_state()` - получает состояние штор с сервера
- `get_thresholds()` - получает пороговые значения для датчиков с сервера

### Работа с фотографиями
- `take_photo()` - делает снимок с подключенной камеры
- `upload_to_server()` - загружает фотографии и результаты анализа на сервер
- `photo_thread_function()` - поток для периодического фотографирования

## Порядок работы программы

1. Запрос API токена у пользователя
2. Выполнение первичного фотографирования и анализа растения
3. Настройка интервалов отправки данных и фотографирования
4. Подключение к Arduino
5. Запуск трех параллельных потоков:
   - Основной поток (чтение данных с Arduino и отправка на сервер)
   - Поток управления устройствами (лампа и шторы)
   - Поток периодического фотографирования

## Пороговые значения и управление

Программа автоматически получает с сервера:
- Пороговые значения для температуры, влажности, уровня CO₂ и др.
- Команды для управления лампой (включение/выключение)
- Команды для управления шторами (открытие/закрытие)

## Анализ заболеваний растений

Программа выявляет следующие проблемы:
- Хлороз (пожелтение листьев)
- Грибковые заболевания (коричневые пятна)
- Мучнистая роса (белый налет)
- Курчавость листьев
- Черная пятнистость
- Увядание
- Мозаичная болезнь

## Обнаружение вредителей

Программа может обнаружить следующих вредителей:
- Тля
- Белокрылка
- Трипсы
- Мучнистые червецы
- Щитовки
- Гусеницы

## Устранение неполадок

### Проблемы с соединением Arduino
- Проверьте правильность COM-порта (по умолчанию COM10)
- Убедитесь, что Arduino подключен к компьютеру
- Проверьте, что порт не занят другой программой

### Проблемы с камерой
- Проверьте подключение камеры
- Убедитесь, что индекс камеры правильный (по умолчанию 0)

### Проблемы с отправкой данных
- Проверьте правильность API токена
- Убедитесь, что есть доступ в интернет
- Проверьте доступность сервера farm429.online

## Важные константы программы

- `CAMERA_INDEX = 0` - индекс камеры
- `SERVER_URL` - URL для загрузки изображений
- `SERIAL_PORT = 'COM10'` - COM-порт для Arduino
- `BAUD_RATE = 9600` - скорость соединения с Arduino

Для изменения настроек отредактируйте соответствующие константы в начале файла FitoDomik_console.py. 
